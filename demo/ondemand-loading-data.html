<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Organization Chart Plugin</title>
  <link rel="icon" href="img/logo.png">
  <link rel="stylesheet" href="css/font-awesome.min.css">
  <link rel="stylesheet" href="css/jquery.orgchart.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="outer-boarder">
    <select id="dropdown"><option value="test">test</option></select>
    <div id="chart-container"></div>
  </div>


  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/jquery.orgchart.js"></script>
  <script type="text/javascript" src="js/jquery.mockjax.min.js"></script>
  <script type="text/javascript" src="js/html2canvas.min.js"></script>
  <script type="text/javascript">
    $(function() {

    $.mockjax({
      url: '/orgchart/children/n3',
      contentType: 'application/json',
      responseTime: 1000,
      responseText: { 'children': [
        { 'id': 'n4', 'name': 'Pang Pang Mod', 'relationship': '100' },
        { 'id': 'n5', 'name': 'Xiang Xiang', 'relationship': '100'}
      ]}
    });

    var datascource = {
      'id': 'diagnostic-engine-migration',
      'name': 'diagnostic-engine-migration',
      'relationship': '001',
      'children': [
        { 'id': 'diagnostic-engine','name': 'diagnostic-engine', 'relationship': '001' },
      ]
    };

    var ajaxURLs = {
      'children': 'http://localhost:3004/services/',
      'parent': '/orgchart/parent/',
      'siblings': function(nodeData) {
        return '/orgchart/siblings/' + nodeData.id;
      },
      'families': function(nodeData) {
        return '/orgchart/families/' + nodeData.id;
      }
    };


    var oc = $('#chart-container').orgchart({
      'data': 'http://localhost:3004/services/hmp-bff',
      'ajaxURL': ajaxURLs,
    //  'nodeContent': 'title',
      'nodeId': 'id',
      'toggleSiblingsResp': 'false',
      'direction':'l2r',
      'pan': true,
      'exportButton': true,
      'exportFilename': 'MyArchChart',
      'nodeContent': 'team',
      'zoom': true
    });

    $.ajax({
            type: "GET",
            url: "http://localhost:3004/list",
            success: function(data)
            {
                helpers.buildDropdown(
                    data,
                    $('#dropdown'),
                    'Select an option'
                );
            }
        });


    $('#dropdown').change(function() {
      oc.init({ 'data': 'http://localhost:3004/services/' + $(this).val() });  
    });

  });

  var helpers =
  {
      buildDropdown: function(result, dropdown, emptyMessage)
      {
          // Remove current options
          dropdown.html('');
          // Add the empty option with the empty message
          dropdown.append('<option value="">' + emptyMessage + '</option>');
          // Check result isnt empty
          if(result != '')
          {
              // Loop through each of the results and append the option to the dropdown
              $.each(result, function(k, v) {
                  dropdown.append('<option value="' + v.id + '">' + v.name + '</option>');
              });
          }
      }
  }
  </script>
  </body>
</html>